# ä¸ºä»€ä¹ˆ CLI ä½¿ç”¨ tsup è€Œä¸æ˜¯ Viteï¼Ÿ

## ç®€çŸ­å›ç­”

**CLI å·¥å…·ä½¿ç”¨ tsup**ï¼Œå› ä¸ºï¼š
- âœ… CLI æ˜¯ Node.js å·¥å…·ï¼Œä¸éœ€è¦ CSS å¤„ç†
- âœ… tsup æ›´è½»é‡ã€æ›´å¿«
- âœ… é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨
- âœ… ä¸“ä¸ºåº“/å·¥å…·æ„å»ºè®¾è®¡

**ç»„ä»¶åº“ä½¿ç”¨ Vite**ï¼Œå› ä¸ºï¼š
- âœ… éœ€è¦ CSS å†…è”åˆ° JS ä¸­ï¼ˆRFC-0016ï¼‰
- âœ… tsup æ— æ³•æ»¡è¶³ CSS å†…è”éœ€æ±‚
- âœ… Vite çš„ `cssCodeSplit: false` å®Œç¾è§£å†³

## è¯¦ç»†å¯¹æ¯”

### tsup çš„ä¼˜åŠ¿ï¼ˆé€‚åˆ CLI/åº“ï¼‰

| ç‰¹æ€§ | tsup | Vite |
|------|------|------|
| **æ„å»ºé€Ÿåº¦** | âš¡ æå¿«ï¼ˆåŸºäº esbuildï¼‰ | ğŸ¢ è¾ƒæ…¢ï¼ˆåŸºäº Rollupï¼‰ |
| **é…ç½®å¤æ‚åº¦** | âœ… é›¶é…ç½® | âš ï¸ éœ€è¦é…ç½®æ–‡ä»¶ |
| **CSS å¤„ç†** | âŒ ä¸æ”¯æŒå†…è” | âœ… æ”¯æŒå†…è” |
| **TypeScript** | âœ… åŸç”Ÿæ”¯æŒ | âœ… æ”¯æŒ |
| **ç±»å‹å®šä¹‰** | âœ… è‡ªåŠ¨ç”Ÿæˆ | âœ… æ”¯æŒ |
| **åŒ…å¤§å°** | âœ… å°ï¼ˆå•ä¸€å·¥å…·ï¼‰ | âš ï¸ å¤§ï¼ˆå®Œæ•´æ„å»ºç³»ç»Ÿï¼‰ |
| **é€‚ç”¨åœºæ™¯** | åº“ã€CLIã€å·¥å…· | åº”ç”¨ã€ç»„ä»¶åº“ï¼ˆéœ€è¦CSSï¼‰ |

### é¡¹ç›®ä¸­çš„ä½¿ç”¨æƒ…å†µ

#### ä½¿ç”¨ tsup çš„åŒ…

1. **`@wsxjs/cli`** - CLI å·¥å…·
   ```json
   "build": "tsup src/index.ts --format esm --dts --clean"
   ```
   - âœ… ä¸éœ€è¦ CSS
   - âœ… éœ€è¦å¿«é€Ÿæ„å»º
   - âœ… é›¶é…ç½®

2. **`@wsxjs/wsx-vite-plugin`** - Vite æ’ä»¶
   ```json
   "build": "tsup src/index.ts --format cjs,esm --dts --external ..."
   ```
   - âœ… çº¯ TypeScript åº“
   - âœ… ä¸éœ€è¦ CSS
   - âœ… éœ€è¦ CJS å’Œ ESM åŒæ ¼å¼

3. **`@wsxjs/eslint-plugin-wsx`** - ESLint æ’ä»¶
   ```json
   "build": "tsup src/index.ts --format cjs,esm --dts --cjs-interop"
   ```
   - âœ… çº¯ TypeScript åº“
   - âœ… ä¸éœ€è¦ CSS

#### ä½¿ç”¨ Vite çš„åŒ…

1. **`@wsxjs/wsx-base-components`** - ç»„ä»¶åº“
   ```typescript
   // vite.config.ts
   export default defineConfig({
     build: {
       lib: { ... },
       cssCodeSplit: false, // å…³é”®ï¼šCSS å†…è”
     },
   });
   ```
   - âœ… **éœ€è¦ CSS å†…è”**ï¼ˆRFC-0016 è¦æ±‚ï¼‰
   - âœ… tsup æ— æ³•æ»¡è¶³æ­¤éœ€æ±‚
   - âœ… Vite çš„ `cssCodeSplit: false` å®Œç¾è§£å†³

## RFC-0016 çš„è¯´æ˜

æ ¹æ® RFC-0016ï¼ˆç»„ä»¶åº“æ„å»ºæŒ‡å—ï¼‰ï¼š

> **é—®é¢˜**: tsup é»˜è®¤å°† CSS æå–åˆ°å•ç‹¬æ–‡ä»¶  
> **è§£å†³**: ä½¿ç”¨ Vite æ„å»ºï¼Œé…ç½® `cssCodeSplit: false`

### ä¸ºä»€ä¹ˆç»„ä»¶åº“å¿…é¡»ç”¨ Viteï¼Ÿ

1. **CSS å†…è”éœ€æ±‚**ï¼š
   - ç»„ä»¶æ ·å¼å¿…é¡»å†…è”åˆ° JS ä¸­
   - ç¡®ä¿ Shadow DOM ä¸­æ­£ç¡®æ˜¾ç¤º
   - ä¿æŒç»„ä»¶å°è£…æ€§

2. **tsup çš„é™åˆ¶**ï¼š
   - tsup åŸºäº esbuild
   - esbuild ä¸æ”¯æŒ CSS å†…è”
   - CSS æ€»æ˜¯è¢«æå–åˆ°å•ç‹¬æ–‡ä»¶

3. **Vite çš„ä¼˜åŠ¿**ï¼š
   - åŸºäº Rollup
   - æ”¯æŒ `cssCodeSplit: false`
   - CSS å¯ä»¥å†…è”åˆ° JS bundle ä¸­

## å†³ç­–æ ‘

```
éœ€è¦æ„å»ºä»€ä¹ˆï¼Ÿ
â”‚
â”œâ”€ CLI å·¥å…·ï¼Ÿ
â”‚  â””â”€ âœ… ä½¿ç”¨ tsupï¼ˆå¿«é€Ÿã€é›¶é…ç½®ï¼‰
â”‚
â”œâ”€ åº“/æ’ä»¶ï¼ˆæ—  CSSï¼‰ï¼Ÿ
â”‚  â””â”€ âœ… ä½¿ç”¨ tsupï¼ˆå¿«é€Ÿã€é›¶é…ç½®ï¼‰
â”‚
â””â”€ ç»„ä»¶åº“ï¼ˆæœ‰ CSSï¼‰ï¼Ÿ
   â””â”€ âœ… ä½¿ç”¨ Viteï¼ˆCSS å†…è”æ”¯æŒï¼‰
```

## æ€§èƒ½å¯¹æ¯”

### æ„å»ºæ—¶é—´ï¼ˆç¤ºä¾‹ï¼‰

| åŒ… | å·¥å…· | æ„å»ºæ—¶é—´ |
|----|------|---------|
| `@wsxjs/cli` | tsup | ~20ms |
| `@wsxjs/eslint-plugin-wsx` | tsup | ~30ms |
| `@wsxjs/wsx-base-components` | Vite | ~500ms |

**æ³¨æ„**ï¼šç»„ä»¶åº“æ„å»ºè¾ƒæ…¢æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºéœ€è¦å¤„ç† CSSã€‚

## æ€»ç»“

### CLI ä½¿ç”¨ tsup çš„åŸå› 

1. âœ… **ä¸éœ€è¦ CSS** - CLI æ˜¯çº¯ Node.js å·¥å…·
2. âœ… **æ„å»ºé€Ÿåº¦å¿«** - tsup åŸºäº esbuildï¼Œæå¿«
3. âœ… **é›¶é…ç½®** - å¼€ç®±å³ç”¨ï¼Œæ— éœ€é…ç½®æ–‡ä»¶
4. âœ… **è½»é‡çº§** - ä¾èµ–å°‘ï¼Œå®‰è£…å¿«
5. âœ… **ç±»å‹æ”¯æŒ** - è‡ªåŠ¨ç”Ÿæˆ `.d.ts` æ–‡ä»¶

### ç»„ä»¶åº“ä½¿ç”¨ Vite çš„åŸå› 

1. âœ… **CSS å†…è”å¿…éœ€** - RFC-0016 è¦æ±‚
2. âœ… **tsup ä¸æ”¯æŒ** - æ— æ³•æ»¡è¶³ CSS å†…è”éœ€æ±‚
3. âœ… **Vite å®Œç¾æ”¯æŒ** - `cssCodeSplit: false` è§£å†³
4. âœ… **æ ‡å‡†å·¥å…·** - ç¤¾åŒºå¹¿æ³›ä½¿ç”¨

## å‚è€ƒ

- [RFC-0016: ç»„ä»¶åº“æ„å»ºæŒ‡å—](../docs/rfcs/0016-component-library-build-guide.md)
- [tsup æ–‡æ¡£](https://tsup.egoist.dev/)
- [Vite åº“æ¨¡å¼](https://vitejs.dev/guide/build.html#library-mode)

